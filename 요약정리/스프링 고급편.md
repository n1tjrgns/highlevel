## 스프링 핵심 원리 - 고급편

----

V3 버전에서 FieldLogTrace를 싱글톤으로 등록하여 작성했다.

하지만 여기서 1초안에 여러번의 호출이 들어왔을 때 꼬이게된다.

- 동시성 문제  : 여러 쓰레드가 동시에 같은 인스턴스의 필드 값을 변경하면서 발생하는 문제

  여러 쓰레드가 같은 인스턴스의 필드에 접근해야 하기 때문에, 싱글톤 객체의 필드를 변경해서 사용할 때는 이런 동시성 문제를 조심해야한다.

```
FieldLogTrace.traceIdHolder를 여러 쓰레드가 동시에 접근하기 떄문에 문제가 발생한다.
```



#### TIP

```
동시성 문제는 지역 변수에서는 발생하지 않는다. 지역 변수는 쓰레드마다 각각 다른 메모리 영역이 할당된다.
동시성 문제가 발생하는 곳은 인스턴스의 필드(주로 싱글톤), 또는 static 공용 필드 접근시 발생한다.
동시성 문제는 값을 읽기만 하면 발생하지 않는다. 어디선가 값을 변경하기 때문에 발생한다.
```

싱글톤 객체의 필드를 사용하면서 동시성 문제를 해결하려면??

- **스레드 로컬**

